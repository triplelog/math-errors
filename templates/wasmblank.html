<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="author" content="">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
  
</head>

<body>

  <input type="text" id="inline-math"></input>
  <div id="output-math"></div>	
  
  <input type="text" id="inline-graph"></input>
  <button onclick="plotChange()">Submit</button>
  <div id="output-graph"></div>	
  
	
  <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
  <!--<script src="wasmhello.js"></script>-->
  <script>
  	var myWorker = new Worker('js/wasmworker.js');
  	
  	myWorker.onmessage = function(e) {
	  result.textContent = e.data;
	  console.log('Message received from worker');
	}
  	function submitMath(input) {
  		latex = "";
  		myWorker.postMessage(input);
  		
  		//l(input);
  		var html = katex.renderToString(latex, {throwOnError: false});
  		autoComplete[input] = html;
  	}
  	function chgAuto(input) {
		var el = document.getElementById('output-math');
		el.innerHTML = autoComplete[input];
	}
  	function answerDown(evt) {
		var key = evt.key;
		if (key != 'Shift'){
			var answer = document.getElementById("inline-math").value;
			submitMath(answer+key);
		}
		
	}
	function answerChange(evt) {
		var answer = document.getElementById("inline-math").value;
		if (autoComplete[answer]){
			chgAuto(answer);
		}
		else {
			submitMath(answer);
			chgAuto(answer);
			
		}
		
	}
	var autoComplete = {};
	var answerEl = document.getElementById('inline-math');
	answerEl.addEventListener('keydown',answerDown);
	answerEl.addEventListener('input',answerChange);
	
	function plotChange(evt) {
		var left = -10;
		var right = 10;
		var spread = 20;
		var bottom = -10;
		var top = 10;
		if (evt){
			spread = evt.target.value;
			left = -.5*spread;
			right = .5*spread;
		}
		else if (document.getElementById("domainSlider")){
			spread = document.getElementById("domainSlider").value;
			left = -.5*spread;
			right = .5*spread;
		}
		var input = document.getElementById("inline-graph").value;
		svg = "";
		//p(input,left,right,bottom,top);
		svg += '<input type="range" id="domainSlider" min="0" max="'+(spread*2)+'" value="'+spread+'"></input>';
		document.getElementById("output-graph").innerHTML = svg;
		document.getElementById("domainSlider").addEventListener('change',plotChange);
	}
  </script>
</body>

</html>